<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order - EasyRecharge MM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff6600;
            --accent-color: #000000;
            --background-color: #ffffff;
            --border-color: #e5e5e5;
            --text-color: #333;
            --success-color: #00cc66;
            --font-family: 'Poppins', sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            color: var(--text-color);
        }

        .container {
            width: 100%;
            max-width: 600px;
            background-color: var(--background-color);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            box-sizing: border-box;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        header h1 {
            color: var(--accent-color);
            margin: 0;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .logo {
            width: 30px;
            height: 30px;
            background-color: var(--primary-color);
            border-radius: 50%;
        }

        .nav-links {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .nav-links a.active, .nav-links a:hover {
            background-color: rgba(255, 102, 0, 0.1);
        }


        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            box-sizing: border-box;
            font-family: var(--font-family);
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.2);
        }

        input[readonly] {
            background-color: #f9f9f9;
            cursor: not-allowed;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .button-group button {
            flex-grow: 1;
            padding: 12px 10px;
            border: 1px solid var(--border-color);
            background-color: var(--background-color);
            border-radius: 10px;
            cursor: pointer;
            font-family: var(--font-family);
            font-size: 14px;
            transition: all 0.3s;
        }

        .button-group button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .phone-group {
            display: flex;
            gap: 10px;
        }
        
        .phone-group input {
            flex-grow: 1;
        }

        #copyBtn {
            padding: 0 15px;
            background-color: #f0f0f0;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #copyBtn:hover {
            background-color: #e0e0e0;
        }

        .price-display {
            background-color: #f4f4f9;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 20px;
            font-weight: 500;
            margin-top: 10px;
        }

        .price-display span {
            color: var(--primary-color);
            font-size: 24px;
        }

        #submitBtn {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-family: var(--font-family);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        #submitBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 102, 0, 0.3);
        }

        #submitBtn:active {
            transform: translateY(0);
        }
        
        #submitBtn:disabled {
            background-color: #ffccaa;
            cursor: wait;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            font-size: 14px;
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        @media (max-width: 400px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            header h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1><div class="logo"></div> EasyRecharge MM</h1>
            <nav class="nav-links">
                <a href="order.html" class="active">Order</a>
                <a href="paytopay.html">P2P Transfer</a>
                <a href="status.html">Status</a>
            </nav>
        </header>

        <form id="orderForm">
            <div class="form-group">
                <label for="userId">User ID</label>
                <input type="text" id="userId" readonly>
            </div>

            <div class="form-group">
                <label>Category</label>
                <div class="button-group" id="categoryGroup">
                    <button type="button" data-category="SIM/Package">SIM/Package</button>
                    <button type="button" data-category="Games TopUp">Games TopUp</button>
                    <button type="button" data-category="SMM">SMM</button>
                </div>
            </div>

            <div class="form-group" id="serviceSection" style="display: none;">
                <label>Service</label>
                <div class="button-group" id="serviceGroup"></div>
            </div>

            <div class="form-group" id="quantitySection" style="display: none;">
                <label for="quantity">Quantity (Qty)</label>
                <input type="number" id="quantity" value="1" min="1" disabled>
            </div>

            <div class="form-group">
                <label>Total Price</label>
                <div class="price-display">
                    <span id="totalPrice">0</span> MMK
                </div>
            </div>

            <div class="form-group">
                <label for="phoneNumber">Phone Number (Chit Ko Ko Lwin)</label>
                <div class="phone-group">
                    <input type="text" id="phoneNumber" value="09791134604" readonly>
                    <button type="button" id="copyBtn" title="Copy Number">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h-1v1a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1V5z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label>Payment Method</label>
                <div class="button-group" id="paymentMethodGroup">
                    <button type="button" data-method="Wave">Wave</button>
                    <button type="button" data-method="KBZPay">KBZPay</button>
                    <button type="button" data-method="AYA">AYA</button>
                </div>
            </div>

            <div class="form-group">
                <label for="transactionId">Transaction ID</label>
                <input type="text" id="transactionId" placeholder="Enter your transaction ID" required>
            </div>

            <button type="submit" id="submitBtn">Submit Order</button>
        </form>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // --- 1. USER ID SETUP ---
        const uid = localStorage.getItem('easyRechargeUserId') || 'XXXXXXXXX';
        document.getElementById('userId').value = uid;

        // --- 2. DATA AND STATE ---
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbxBvHw1n76vONXb8uoIZaUGYwx0Osj_NnBXG54yx2XX-FNuqg5QKg3W2m_KBtGEQW5AYQ/exec'; // IMPORTANT: Replace with your GAS URL

        const services = {
            "SIM/Package": [
                { name: "Mytel 1GB", price: 1000 },
                { name: "Ooredoo 2GB", price: 2000 },
                { name: "Telenor 5GB", price: 5000 },
            ],
            "Games TopUp": [
                { name: "MLBB 100💎", price: 3000 },
                { name: "PUBG 660 UC", price: 15000 },
                { name: "Valorant 500 VP", price: 10000 },
            ],
            "SMM": [
                { name: "FB Likes", price: 5 },
                { name: "IG Followers", price: 10 },
                { name: "YT Views", price: 8 },
            ]
        };

        let state = {
            category: null,
            service: null,
            quantity: 1,
            total: 0,
            paymentMethod: null,
        };

        // --- 3. DOM ELEMENTS ---
        const categoryGroup = document.getElementById('categoryGroup');
        const serviceSection = document.getElementById('serviceSection');
        const serviceGroup = document.getElementById('serviceGroup');
        const quantitySection = document.getElementById('quantitySection');
        const quantityInput = document.getElementById('quantity');
        const totalPriceEl = document.getElementById('totalPrice');
        const paymentMethodGroup = document.getElementById('paymentMethodGroup');
        const orderForm = document.getElementById('orderForm');
        const submitBtn = document.getElementById('submitBtn');
        const toast = document.getElementById('toast');
        const copyBtn = document.getElementById('copyBtn');
        const phoneNumberInput = document.getElementById('phoneNumber');

        // --- 4. FUNCTIONS ---
        function renderServices() {
            serviceGroup.innerHTML = '';
            if (!state.category) {
                serviceSection.style.display = 'none';
                return;
            }

            const currentServices = services[state.category];
            currentServices.forEach(s => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.textContent = `${s.name} (${s.price} MMK)`;
                btn.dataset.name = s.name;
                btn.dataset.price = s.price;
                serviceGroup.appendChild(btn);
            });
            serviceSection.style.display = 'block';
        }

        function updatePrice() {
            if (state.service) {
                state.total = state.service.price * state.quantity;
            } else {
                state.total = 0;
            }
            totalPriceEl.textContent = state.total;
        }
        
        function showToast(message, isSuccess = true) {
            toast.textContent = message;
            toast.style.backgroundColor = isSuccess ? 'var(--success-color)' : '#ff3333';
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function resetForm() {
            state = { category: null, service: null, quantity: 1, total: 0, paymentMethod: null };
            document.querySelectorAll('.button-group button.active').forEach(b => b.classList.remove('active'));
            renderServices();
            updatePrice();
            quantityInput.value = 1;
            quantityInput.disabled = true;
            quantitySection.style.display = 'none';
            orderForm.reset();
            document.getElementById('userId').value = uid; // Re-apply UID after reset
        }

        // --- 5. EVENT LISTENERS ---
        categoryGroup.addEventListener('click', e => {
            if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('#categoryGroup button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');

                state.category = e.target.dataset.category;
                state.service = null;
                state.quantity = 1;
                quantityInput.value = 1;

                if (state.category === 'SMM') {
                    quantitySection.style.display = 'block';
                    quantityInput.disabled = false;
                } else {
                    quantitySection.style.display = 'none';
                    quantityInput.disabled = true;
                }

                renderServices();
                updatePrice();
            }
        });

        serviceGroup.addEventListener('click', e => {
            if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('#serviceGroup button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                state.service = {
                    name: e.target.dataset.name,
                    price: parseInt(e.target.dataset.price)
                };
                updatePrice();
            }
        });
        
        quantityInput.addEventListener('input', e => {
            state.quantity = parseInt(e.target.value) || 1;
            if (state.quantity < 1) {
                state.quantity = 1;
                e.target.value = 1;
            }
            updatePrice();
        });

        paymentMethodGroup.addEventListener('click', e => {
             if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('#paymentMethodGroup button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                state.paymentMethod = e.target.dataset.method;
            }
        });

        copyBtn.addEventListener('click', () => {
            phoneNumberInput.select();
            document.execCommand('copy');
            showToast('✅ Phone Number Copied!');
        });

        orderForm.addEventListener('submit', async e => {
            e.preventDefault();
            const transactionId = document.getElementById('transactionId').value.trim();

            if (!state.category || !state.service || !state.paymentMethod || !transactionId) {
                showToast('❌ Please fill all fields.', false);
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const data = {
                type: 'order',
                userId: uid,
                category: state.category,
                service: state.service.name,
                quantity: state.quantity,
                total: state.total,
                paymentMethod: state.paymentMethod,
                transactionId: transactionId
            };
            
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Use no-cors for basic requests to GAS
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    redirect: 'follow'
                });
                // Since no-cors gives an opaque response, we assume success and let the backend handle errors.
                showToast('✅ Order Submitted Successfully!');
                resetForm();

            } catch (error) {
                console.error('Error:', error);
                showToast('❌ Submission failed. Please try again.', false);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Order';
            }
        });
    </script>
</body>
</html>

  
